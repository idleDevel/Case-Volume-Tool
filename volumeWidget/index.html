<!DOCTYPE html>
<html>
<head>
  <title>Dimension Modifier</title>
  <script>
    
     document.addEventListener('DOMContentLoaded', function() {
      const inputFields = document.querySelectorAll('input');

      inputFields.forEach(function(inputField) {
        inputField.addEventListener('blur', function() {
          if (inputField.value === '') {
            inputField.value = inputField.getAttribute('data-default');
          }
        });

      inputField.setAttribute('data-default', inputField.value);
    });
  });

  
    function calculateDimensions() {
      // Get the input values
      var length = parseFloat(document.getElementById("length").value);
      var width = parseFloat(document.getElementById("width").value);
      var height = parseFloat(document.getElementById("height").value);
      var lengthModifier = parseFloat(document.getElementById("lengthModifier").value);
      var widthModifier = parseFloat(document.getElementById("widthModifier").value);
      var heightModifier = parseFloat(document.getElementById("heightModifier").value);
      
      //serializeInputValues(length, width, height, lengthModifier, widthModifier, heightModifier);
      // Calculate modified dimensions
      var modifiedLength = length + lengthModifier;
      var modifiedWidth = width + widthModifier;
      var modifiedHeight = height + heightModifier;
      

      // Convert to selected length units
      var unitSelect_L = document.getElementById("lengthUnits");
      var selectedUnits_L = unitSelect_L.options[unitSelect_L.selectedIndex].value;
      switch (selectedUnits_L) {
            case "mm":
                console.log("mm");
                length /= 10; // Conversion from millimeters (mm) to centimeters (cm)
                width /= 10;
                height /= 10;
                modifiedLength /= 10;
                modifiedWidth /= 10;
                modifiedHeight /= 10;
                break;
            case "cm":
                console.log("cm");
                // No conversion needed
                break;
            default:
                console.log("Unknown length unit");
                break;
        }
      
    //caluculate the volume:
    var base_volume = length * width * height;
    var modified_volume = modifiedLength * modifiedWidth * modifiedHeight;
    var decimalPlaces = 6;

    // Convert to selected volume units
    var unitSelect_V = document.getElementById("volumeUnits");
    var selectedUnits_V = unitSelect_V.options[unitSelect_V.selectedIndex].value;

    switch (selectedUnits_V) {
        case "cm3":
            console.log("cm3");
            // No conversion needed
            break;
        case "liters":
            console.log("L");
            base_volume /= 1000; // Conversion from cubic centimeters (cm³) to liters (L)
            modified_volume /= 1000;
            break;
        default:
            console.log("Unknown volume unit");
            break;
    }
      
      base_volume = base_volume.toFixed(decimalPlaces);
      modified_volume = modified_volume.toFixed(decimalPlaces);

      // Display the results
      document.getElementById("baseVolume").innerHTML = "Base Volume: " + base_volume;
      document.getElementById("modifiedVolume").innerHTML = "Modified Volume: " + modified_volume;
    }

  
  </script>
</head>
<body>
  <form>
    <h2>Volume Modifier</h2>
    <table>
      <tr>
        <td></table><button onclick="serializeInputValues()">Save Inputs</button></td>
        <td></table><button onclick="loadInputValues()">Load Inputs</button></td>
      </tr>
    <table>
        <tr>
            <td><label for="lengthUnits">Dimension Units:</label></td>
            <td colspan="3">
              <select id="lengthUnits">
                <option value="mm" selected>Millimeters (mm)</option>
                <option value="cm">Centimeters (cm)</option>
              </select>
            </td>
        </tr>
        <tr>
            <td><label for="length">Length:</label></td>
            <td><input type="number" id="length" step="any" value="0" required></td>
            <td>+</td>
            <td> <label for="lengthModifier">Length Modifier:</label></td>
            <td><input type="number" id="lengthModifier" step="any" value="0" required></td>
        </tr>
        <tr>
            <td><label for="width">Width:</label></td>
            <td><input type="number" id="width" step="any" value="0" required></td>
            <td>+</td>
            <td><label for="widthModifier">Width Modifier:</label></td>
            <td><input type="number" id="widthModifier" step="any" value="0" required></td>
        </tr>
        <tr>
            <td><label for="height">Height:</label></td>
            <td><input type="number" id="height" step="any" value="0" required></td>
            <td>+</td>
            <td><label for="heightModifier">Height Modifier:</label></td>
            <td><input type="number" id="heightModifier" step="any" value="0" required></td>
        </tr>
        <tr>
            <td><label for="volumeUnits">Volume Units:</label></td>
            <td colspan="3">
              <select id="volumeUnits">
                <option value="cm3">Cubic Centimeters (cm³)</option>
                <option value="liters" selected>Liters (L)</option>
              </select>
            </td>
        </tr>
        <tr>
            <td><input type="button" value="Calculate" onclick="calculateDimensions()"></td>
        </tr>
    </table>
  </form>
  <br>
  <div id="baseVolume"></div>
  <div id="modifiedVolume"></div>
  <div id="response-container"></div>
</body>
<script>
  function serializeInputValues() {
    //l, w, h, ml, mw, mh
    // Get the input values
    var unit_l = document.getElementById("lengthUnits").value;
    var l = parseFloat(document.getElementById("length").value);
    var w = parseFloat(document.getElementById("width").value);
    var h = parseFloat(document.getElementById("height").value);
    var ml = parseFloat(document.getElementById("lengthModifier").value);
    var mw = parseFloat(document.getElementById("widthModifier").value);
    var mh = parseFloat(document.getElementById("heightModifier").value);
    var unit_v = document.getElementById("volumeUnits").value;
    // Save the input values as a JSON object
    var inputValues = {
      dimensionUnits: unit_l,
      length: l,
      width: w,
      height: h,
      lengthModifier: ml,
      widthModifier: mw,
      heightModifier: mh,
      volumeUnits: unit_v,
    };
    
    // Convert the JSON object to a string
    var inputValuesString = JSON.stringify(inputValues);
    //console.log(inputValuesString);
    // Call the Python function and pass the JSON string
    saveInputValues(inputValuesString);
  }

  function saveInputValues(data) {
    pywebview.api.save_json(data)    
  }

  function loadInputValues(){
    pywebview.api.load_json();
    logToPython("Called Load!");
  }

  function logToPython(message) {
        pywebview.api.handle_console_log(message)
    }
  
</script>
</html>